// app.js
import { initPersonas } from './personas.js';                   // personas.js – 人物管理相关
import { loadSystemRules } from './system_rules.js';            // system_rules.js – 系统规则
import { loadConversations, loadActiveId, saveConversations, getActiveConv, uid } from './conversations.js';        // conversations.js – 会话管理
import { setupSidebar } from './sidebar.js';                    // sidebar.js – 侧边栏操作
import { setupChatForm } from './chat_form.js';                 // chat_form.js – 表单提交、流式输出
import { setupHistoryButtons } from './history.js';             // history.js – 历史会话加载与清空

document.addEventListener("DOMContentLoaded", () => {
  initPersonas();
  loadSystemRules();

  let conversations = loadConversations();
  let activeId = loadActiveId();

  const { openSidebar, closeSidebar } = setupSidebar("sidebar", "btn-toggle");

  setupChatForm({
    formId: "chat-form",
    promptId: "prompt",
    sendBtnId: "btn-send",
    messagesId: "messages",
    webInputId: "web_input"
  });

  setupHistoryButtons({
    reloadId: "btn-reload-history",
    clearId: "btn-clear-history",
    getActiveConv: () => getActiveConv(conversations, activeId),
    saveFn: () => saveConversations(conversations, activeId),
    renderMessages: () => {} // 可填 renderMessages 函数
  });

  window.addEventListener("resize", () => { if (window.innerWidth > 900) closeSidebar(); });
});





